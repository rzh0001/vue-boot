<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.pay.mapper.UserChannelEntityMapper">
    <select id="queryChannelAndUser" parameterType="String"  resultType="org.jeecg.modules.pay.entity.UserChannelEntity">
        select * from sys_user_channel where user_name=#{userName} and channel_code=#{channelCode}  and del_flag is null
    </select>
    <select id="queryUserChannel" resultType="java.lang.String" parameterType="java.lang.String">
        select channel_code from sys_user_channel where user_name=#{userName} and channel_code in
        <foreach collection="channelCodes" item="code" index="index" open="(" close=")" separator=",">
            #{code}
        </foreach>
        order by update_time DESC
    </select>
    <insert id="batchSave">
        insert into sys_user_channel (id,user_id,user_name,channel_code,member_type) values
        <foreach collection="channels" item="channel" separator=","  open="(" close=")">
            (SELECT REPLACE(UUID(), '-', '') AS id),#{sysUser.id},#{sysUser.username},#{channel.channelCode},#{sysUser.memberType}
        </foreach>
    </insert>
    <delete id="deleteChannel">
        delete from sys_user_channel where user_name=#{userName} and channel_code in
        <foreach collection="codes" item="code" separator="," open="(" close=")">
            #{code}
        </foreach>
    </delete>
</mapper>